<!-- This template is needed for a toggling solution -->
<!-- https://stackoverflow.com/questions/2454577/sphinx-restructuredtext-show-hide-code-snippets -->

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Clusters &#8212; Retentioneering 3.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/js/custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guides/clusters';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Funnel" href="funnel.html" />
    <link rel="prev" title="StepSankey" href="step_sankey.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/rete_logo.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/rete_logo_white.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../datasets.html">
                        Datasets
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference.html">
                        API Reference
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../datasets.html">
                        Datasets
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference.html">
                        API Reference
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="eventstream.html"> Eventstream</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dataprocessors.html"> DataProcessors</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html"> Preprocessing</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="transition_graph.html"> Transition Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="step_matrix.html"> Step Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="step_sankey.html"> Step Sankey</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"> Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="funnel.html"> Funnels</a></li>
<li class="toctree-l1"><a class="reference internal" href="cohorts.html"> Cohorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="stattests.html"> Stattests</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <style>
    .red {color:#24ff83; font-weight:bold;}
</style><section id="clusters">
<h1>Clusters<a class="headerlink" href="#clusters" title="Permalink to this heading">#</a></h1>
<p>The following user guide is also available as <a class="reference external" href="https://colab.research.google.com/drive/1czRNCWcena5KlyPIJR7RRuXNQltl9mKQ?usp=share_link">Google Colab notebook</a>.</p>
<section id="loading-data">
<h2>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this heading">#</a></h2>
<p>We use <code class="docutils literal notranslate"><span class="pre">simple_shop</span></code> dataset for demonstration purposes. If you want to use your
own dataset, upload it following <a class="reference internal" href="eventstream.html"><span class="doc">this instruction</span></a>.</p>
<p><span class="red">TODO: change the anchored link when rst doc is ready</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">retentioneering</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">stream</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_simple_shop</span><span class="p">()</span>\
    <span class="o">.</span><span class="n">split_sessions</span><span class="p">(</span><span class="n">session_cutoff</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Above we use an additional call of <a class="reference internal" href="../api/data_processors/split_sessions.html"><span class="doc">SplitSessions</span></a> data processor.
We’ll need this session info in one of the examples in this user guide.</p>
</section>
<section id="general-usage">
<h2>General usage<a class="headerlink" href="#general-usage" title="Permalink to this heading">#</a></h2>
<p>The cases in this section demonstrate the ways you can treat <code class="docutils literal notranslate"><span class="pre">Clusters</span></code>
tool. In each case we’ll do the same thing:</p>
<ul class="simple">
<li><p>create <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> instance,</p></li>
<li><p>fit clusters with <code class="docutils literal notranslate"><span class="pre">method='kmeans'</span></code>, <code class="docutils literal notranslate"><span class="pre">n_clusters=4</span></code>, <code class="docutils literal notranslate"><span class="pre">feature_type='tfidf'</span></code>, <code class="docutils literal notranslate"><span class="pre">ngram_range=(1,</span> <span class="pre">1)</span></code> parameters,</p></li>
<li><p>use a tool for cluster analysis (e.g. <a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.plot" title="retentioneering.tooling.clusters.clusters.Clusters.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></a> for simplicity).</p></li>
</ul>
<section id="separate-instance-of-clusters">
<h3>Separate instance of Clusters<a class="headerlink" href="#separate-instance-of-clusters" title="Permalink to this heading">#</a></h3>
<p>One way of using the <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> tool is sort of traditional. You can
create a separate instance of <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> explicitly, and call <code class="docutils literal notranslate"><span class="pre">fit</span></code>
and <code class="docutils literal notranslate"><span class="pre">plot</span></code> methods then.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">retentioneering.tooling.clusters</span> <span class="kn">import</span> <span class="n">Clusters</span>

<span class="n">clusters</span> <span class="o">=</span> <span class="n">Clusters</span><span class="p">(</span><span class="n">eventstream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
<span class="n">clusters</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="s1">&#39;tfidf&#39;</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/basic_plot.png" src="../_images/basic_plot.png" />
</section>
<section id="eventstream-clusters-property">
<h3>Eventstream.clusters property<a class="headerlink" href="#eventstream-clusters-property" title="Permalink to this heading">#</a></h3>
<p><a class="reference internal" href="../api/tooling/clusters.html"><span class="doc">Eventstream.clusters</span></a> property creates an instance
of <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> class, stores it inside <code class="docutils literal notranslate"><span class="pre">Eventstream</span></code> object, and returns a
link to this instance. So you can either save this link as a separate variable
and treat it how we showed in the previous example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">clusters</span>
<span class="n">clusters</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="s1">&#39;tfidf&#39;</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>or you can use <code class="docutils literal notranslate"><span class="pre">stream.clusters</span></code> link as is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span><span class="o">.</span><span class="n">clusters</span>\
    <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="s1">&#39;tfidf&#39;</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">stream</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>We pay your attention that once created <code class="docutils literal notranslate"><span class="pre">Eventstream.clusters</span></code> is kept inside Eventstream
object forever until eventstream is alive. You can re-fit it as many times as you want, but
you can not remove it.</p>
</section>
</section>
<section id="fitting-clusters">
<h2>Fitting clusters<a class="headerlink" href="#fitting-clusters" title="Permalink to this heading">#</a></h2>
<p>Fitting clusters is a core and obligatory step for cluster analysis. If the <code class="docutils literal notranslate"><span class="pre">Clusters</span></code>
object is not fitted, you can not use any cluster analysis tool.</p>
<section id="retentioneering-clustering">
<h3>Retentioneering clustering<a class="headerlink" href="#retentioneering-clustering" title="Permalink to this heading">#</a></h3>
<p>A primary way to set clusters is to use <a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.fit" title="retentioneering.tooling.clusters.clusters.Clusters.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.fit()</span></code></a> method.
It’s implementation is mainly based on sklearn clustering methods. Here’s an example of such a fitting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span> <span class="o">=</span> <span class="n">Clusters</span><span class="p">(</span><span class="n">eventstream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
<span class="n">clusters</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="s1">&#39;tfidf&#39;</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>So far <code class="docutils literal notranslate"><span class="pre">method</span></code> supports two options: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">kmeans</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.mixture.GaussianMixture.html">gmm</a>.
<code class="docutils literal notranslate"><span class="pre">n_clusters</span></code> obviously means the number of clusters since both K-means and GMM
algorithms need it to be pre-defined.</p>
<p>The following couple of arguments <code class="docutils literal notranslate"><span class="pre">feature</span> <span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">ngram_range</span></code> stands for the type
of vectorization. By vectorization we mean the way user trajectories are converted to vectors
in some feature space. In general, vectorization procedure comprises two steps:</p>
<ul class="simple">
<li><p>Split user paths into short subsequencies called <code class="docutils literal notranslate"><span class="pre">n-grams</span></code>.</p></li>
<li><p>Calculate some statistics taking into account how often each n_gram is represented in a user’s trajectory.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ngram_range</span></code> argument controls the range of n-gram length to be used in the vectorization.
For example, <code class="docutils literal notranslate"><span class="pre">ngram_range=(1,</span> <span class="pre">3)</span></code> means that we’re going to use n-grams of length 1
(single events, that is, <em>unigrams</em>), 2 (<em>bigrams</em>), and 3 (<em>trigrams</em>).</p>
<p><code class="docutils literal notranslate"><span class="pre">feature</span> <span class="pre">type</span></code> argument stands for the type of vectorization.  Besides standard
<code class="docutils literal notranslate"><span class="pre">tfidf</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">frequency</span></code> and <code class="docutils literal notranslate"><span class="pre">binary</span></code> features, <code class="docutils literal notranslate"><span class="pre">markov</span></code> and time-related
(<code class="docutils literal notranslate"><span class="pre">time</span></code> and <code class="docutils literal notranslate"><span class="pre">time_fraction</span></code>) features are available.
See <a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.extract_features" title="retentioneering.tooling.clusters.clusters.Clusters.extract_features"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.extract_features()</span></code></a>
for the details.</p>
<p>If this vectorization is not enough, you can use your own features passing it as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>
to <code class="docutils literal notranslate"><span class="pre">vector</span></code> argument.</p>
</section>
<section id="custom-clustering">
<h3>Custom clustering<a class="headerlink" href="#custom-clustering" title="Permalink to this heading">#</a></h3>
<p>We believe that advanced data scientists could tune a great clustering model
by their own, so all they need from Clusters module is just to upload
clustering results and then use Clusters analytical tools. In this case you can
use the results of your own clustering by passing <code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code> representing
the mapping between the users and the clusters to
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.set_clusters" title="retentioneering.tooling.clusters.clusters.Clusters.set_clusters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.set_clusters()</span></code></a>
method. Once the method is called, the <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> object is
considered as fitted, so you can call an analytical method afterwards.</p>
<p>The next example demonstrates random splitting into 4 clusters. <code class="docutils literal notranslate"><span class="pre">user_clusters</span></code>
variable holds the mapping information on how the users correspond to the clusters.
We pass this variable next as an argument for <code class="docutils literal notranslate"><span class="pre">set_clusters</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">user_ids</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">cluster_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">user_ids</span><span class="p">))</span>
<span class="n">user_clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cluster_ids</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">user_ids</span><span class="p">)</span>
<span class="n">user_clusters</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">219483890</span>    <span class="mi">2</span>
<span class="mi">964964743</span>    <span class="mi">3</span>
<span class="mi">629881394</span>    <span class="mi">0</span>
<span class="mi">629881395</span>    <span class="mi">2</span>
<span class="mi">495985018</span>    <span class="mi">2</span>
            <span class="o">..</span>
<span class="mi">125426031</span>    <span class="mi">3</span>
<span class="mi">26773318</span>     <span class="mi">3</span>
<span class="mi">965024600</span>    <span class="mi">0</span>
<span class="mi">831491833</span>    <span class="mi">1</span>
<span class="mi">962761227</span>    <span class="mi">2</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">3751</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters_random</span> <span class="o">=</span> <span class="n">Clusters</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="n">clusters_random</span><span class="o">.</span><span class="n">set_clusters</span><span class="p">(</span><span class="n">user_clusters</span><span class="p">)</span>
<span class="n">clusters_random</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/basic_plot_random_clustering.png" src="../_images/basic_plot_random_clustering.png" />
<p>From this plot we see that the cluster sizes are close to each other
which is exactly what we expect from random splitting.</p>
</section>
</section>
<section id="cluster-analysis">
<h2>Cluster analysis<a class="headerlink" href="#cluster-analysis" title="Permalink to this heading">#</a></h2>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Permalink to this heading">#</a></h3>
<section id="basic-cluster-statistics">
<h4>Basic cluster statistics<a class="headerlink" href="#basic-cluster-statistics" title="Permalink to this heading">#</a></h4>
<p><a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.plot" title="retentioneering.tooling.clusters.clusters.Clusters.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.plot()</span></code></a>
method is used for visualising basic cluster statistics.
By default it shows the cluster sizes as the percentage of the
eventstream users belonging to a specific cluster. If <code class="docutils literal notranslate"><span class="pre">targets</span></code>
parameter is defined, the conversion rate for each cluster and
each target event is displayed as well. By conversion rate we mean
the proportion of the users belonging to a specific cluster
who had at least one target event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cart&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/plot_target.png" src="../_images/plot_target.png" />
<p>The diagram above shows that cluster 0 contains ~40% of the
eventstream users, 60% of them have at least one <code class="docutils literal notranslate"><span class="pre">cart</span></code>
event in their trajectories, and only ~7% of them paid at least
once.</p>
</section>
<section id="projections">
<h4>Projections<a class="headerlink" href="#projections" title="Permalink to this heading">#</a></h4>
<p>Since the feature spaces are of high dimensions, fitted clusters are
hard to visualize. For this purpose 2D-projections are used. Due to
the nature of projection, it provides a simplified or event distorted
picture, but at least it makes clusters visualization possible.</p>
<p>Our
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.projection" title="retentioneering.tooling.clusters.clusters.Clusters.projection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.projection()</span></code></a>
implementation supports two techniques, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">TSNE</a> and
<a class="reference external" href="https://umap-learn.readthedocs.io/en/latest/index.html">UMAP</a>, perhaps the most popular among contemporary dimensionality
reduction algorithms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;tsne&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/projection_tsne.png" src="../_images/projection_tsne.png" />
<p>Each dot represents a single user. Users with similar behaviour are
located close to each other.</p>
<p><code class="docutils literal notranslate"><span class="pre">plot_type='targets'</span></code> along with <code class="docutils literal notranslate"><span class="pre">targets</span></code> argument color the
projected dots with respect to conversion rates associated with
the events defined in <code class="docutils literal notranslate"><span class="pre">targets</span></code>. If at least one target event
appeared in a user’s trajectory, the user will be colored as converted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cart&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/projection_targets.png" src="../_images/projection_targets.png" />
</section>
</section>
<section id="exploring-individual-clusters">
<h3>Exploring individual clusters<a class="headerlink" href="#exploring-individual-clusters" title="Permalink to this heading">#</a></h3>
<p>Essentially, any cluster splitting provides nothing but a mapping
rule which assigns each user to some group. The way we understand
why one clusters differs from another is always tricky, but either
we consider the entire eventstream or its subset (a user cluster)
the exploration techniques may be the same. It means having a cluster
defined we can narrow the entire eventstream and leave only the
paths belonging to the users from a particular cluster. This is what
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.filter_cluster" title="retentioneering.tooling.clusters.clusters.Clusters.filter_cluster"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.filter_cluster()</span></code></a>
method was designed for. It returns the narrowed eventstream so we can
apply any <a class="reference internal" href="../user_guide.html"><span class="doc">Retentioneering analytical tool</span></a> afterwards.
In the following example we apply
<a class="reference internal" href="../api/tooling/transition_graph.html#retentioneering.eventstream.eventstream.Eventstream.transition_graph" title="retentioneering.eventstream.eventstream.Eventstream.transition_graph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transition_graph()</span></code></a>
method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span>\
    <span class="o">.</span><span class="n">filter_cluster</span><span class="p">(</span><span class="n">cluster_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">transition_graph</span><span class="p">(</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;lost&#39;</span><span class="p">:</span> <span class="s1">&#39;bad&#39;</span><span class="p">,</span>
            <span class="s1">&#39;payment_done&#39;</span><span class="p">:</span> <span class="s1">&#39;nice&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
<iframe
    width="600"
    height="600"
    src="../_static/user_guides/clusters/cluster_transition_graph.html"
    frameborder="0"
    allowfullscreen
></iframe></section>
<section id="cluster-comparison">
<h3>Cluster comparison<a class="headerlink" href="#cluster-comparison" title="Permalink to this heading">#</a></h3>
<p>It’s natural to describe cluster characteristics in terms of event
frequencies generated by the users from the cluster.
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.event_dist" title="retentioneering.tooling.clusters.clusters.Clusters.event_dist"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.event_dist()</span></code></a>
allows to do this. It takes <code class="docutils literal notranslate"><span class="pre">cluster_id1</span></code> cluster to be described
and plots <code class="docutils literal notranslate"><span class="pre">top_n</span></code> the most frequent events related to this cluster.
In comparison, it shows the frequencies of the same events but within
<code class="docutils literal notranslate"><span class="pre">cluster_id2</span></code> if the latter is defined. Otherwise, the frequencies
over the entire eventstream are shown.</p>
<p>The next example demonstrates that within cluster 0 event <code class="docutils literal notranslate"><span class="pre">catalog</span></code> takes
~37% of all events generated by the users from this cluster, whereas
in the original eventstream <code class="docutils literal notranslate"><span class="pre">catalog</span></code> event holds ~30% of all events only.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">event_dist</span><span class="p">(</span><span class="n">cluster_id1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/event_dist.png" src="../_images/event_dist.png" />
<p>Such definition of event frequency often is not convenient since it’s hard
to interpret. One may consider to use <code class="docutils literal notranslate"><span class="pre">weight_col</span></code> argument instead which
normalize event frequencies with respect to the defined column. The most
common argument values are <code class="docutils literal notranslate"><span class="pre">user_id'</span></code> and <code class="docutils literal notranslate"><span class="pre">session_id</span></code> (assuming that
the session split was created and <code class="docutils literal notranslate"><span class="pre">session_id</span></code> column exists).
Thus, <code class="docutils literal notranslate"><span class="pre">weight_col='user_id'</span></code> displays the fractions of the users who had
at least one particular event. <code class="docutils literal notranslate"><span class="pre">weight_col='session_id'</span></code> displays the
fractions of the sessions which contain at least one particular event.</p>
<p>Also we use <code class="docutils literal notranslate"><span class="pre">top_n</span></code> argument which controls the number of the events
to be compared.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">event_dist</span><span class="p">(</span><span class="n">cluster_id1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/plot_weight_col_user_id.png" src="../_images/plot_weight_col_user_id.png" />
<p>Now, we see that 100% of the users in cluster 0 had at least one <code class="docutils literal notranslate"><span class="pre">catalog</span></code>
event, whereas only 97% of the users in the entire eventstream had the
same event.</p>
<p>Similarly, defining <code class="docutils literal notranslate"><span class="pre">weight_col='user_id'</span></code> we get the following diagram:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">event_dist</span><span class="p">(</span><span class="n">cluster_id1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/plot_weight_col_session_id.png" src="../_images/plot_weight_col_session_id.png" />
<p>As we see from this diagram, if we look at the sessions generated
by the users from cluster 0, only ~95% of these sessions contain
at least one <code class="docutils literal notranslate"><span class="pre">catalog</span></code> event. In comparison, the sessions from
the entire eventstream contain <code class="docutils literal notranslate"><span class="pre">catalog</span></code> event only in ~83% of cases.</p>
<p>You can not only comparing clusters with the whole eventstream, but
with other clusters too. Simply define <code class="docutils literal notranslate"><span class="pre">cluster_id2</span></code> argument for
that.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">event_dist</span><span class="p">(</span><span class="n">cluster_id1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_id2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/plot_cluster1_cluster2.png" src="../_images/plot_cluster1_cluster2.png" />
<p>We see that <code class="docutils literal notranslate"><span class="pre">all</span></code> value in the diagram legend has been replaced
with <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">1</span></code> value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consider to use differential <a class="reference internal" href="../api/tooling/step_matrix.html"><span class="doc">step matrix</span></a>
(i.e. with <code class="docutils literal notranslate"><span class="pre">groups</span></code> argument defined) for cluster comparison.</p>
</div>
</section>
<section id="getting-clustering-results">
<h3>Getting clustering results<a class="headerlink" href="#getting-clustering-results" title="Permalink to this heading">#</a></h3>
<p>If you want to explicitly get the results of the clustering (i.e.
mapping rule <code class="docutils literal notranslate"><span class="pre">user_id</span> <span class="pre">-&gt;</span> <span class="pre">cluster_id</span></code>), there are two methods
to do this.</p>
<p><a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.user_clusters" title="retentioneering.tooling.clusters.clusters.Clusters.user_clusters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.user_clusters()</span></code></a>
returns a <code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code> containing user_ids as index and cluster_ids
as values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">user_clusters</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">219483890</span>    <span class="mi">2</span>
<span class="mi">964964743</span>    <span class="mi">3</span>
<span class="mi">629881394</span>    <span class="mi">0</span>
<span class="mi">629881395</span>    <span class="mi">2</span>
<span class="mi">495985018</span>    <span class="mi">2</span>
            <span class="o">..</span>
<span class="mi">125426031</span>    <span class="mi">3</span>
<span class="mi">26773318</span>     <span class="mi">3</span>
<span class="mi">965024600</span>    <span class="mi">0</span>
<span class="mi">831491833</span>    <span class="mi">1</span>
<span class="mi">962761227</span>    <span class="mi">2</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">3751</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.cluster_mapping" title="retentioneering.tooling.clusters.clusters.Clusters.cluster_mapping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.cluster_mapping()</span></code></a>
returns a dictionary containing <code class="docutils literal notranslate"><span class="pre">cluster_id</span> <span class="pre">-&gt;</span> <span class="pre">list[user_ids]</span></code> mapping.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_mapping</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">cluster_mapping</span>
<span class="nb">list</span><span class="p">(</span><span class="n">cluster_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">cluster_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">629881394</span><span class="p">,</span>
 <span class="mi">729416583</span><span class="p">,</span>
 <span class="mi">24427596</span><span class="p">,</span>
 <span class="mi">730545582</span><span class="p">,</span>
 <span class="mi">836120732</span><span class="p">,</span>
 <span class="mi">428990197</span><span class="p">,</span>
 <span class="mi">753512589</span><span class="p">,</span>
 <span class="mi">968444450</span><span class="p">,</span>
 <span class="mi">190361938</span><span class="p">,</span>
 <span class="mi">754402650</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="extracting-features">
<h3>Extracting features<a class="headerlink" href="#extracting-features" title="Permalink to this heading">#</a></h3>
<p>In some scenarios one might want to get the vectorized features
which <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> can calculate.
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.extract_features" title="retentioneering.tooling.clusters.clusters.Clusters.extract_features"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.extract_features()</span></code></a>
is the method which is called inside
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.fit" title="retentioneering.tooling.clusters.clusters.Clusters.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.fit()</span></code></a>.
It uses a couple of parameters <code class="docutils literal notranslate"><span class="pre">feature_type</span></code> and <code class="docutils literal notranslate"><span class="pre">ngram_range</span></code>.
See <a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.fit" title="retentioneering.tooling.clusters.clusters.Clusters.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.fit()</span></code></a> for the details.</p>
<p>Note that feature names which are based on ngrams are designed according
to the following pattern <code class="docutils literal notranslate"><span class="pre">event_1</span> <span class="pre">...</span> <span class="pre">event_n_FEATURE_TYPE</span></code>. For example,
for a bigram <cite>cart -&gt; delivery_choice</cite> and <cite>feature_type=’tfidf’</cite> the
corresponding feature name will be <cite>cart delivery_choice_tfidf</cite>.</p>
<p>As for time-based features (<cite>time</cite>, <cite>time_fraction</cite>), they are associated
with a single event, so their names would be <cite>cart_time</cite> or
<cite>delivery_choice_time_fraction</cite></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">feature_type</span><span class="o">=</span><span class="s1">&#39;tfidf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cart_tfidf</th>
      <th>cart cart_tfidf</th>
      <th>...</th>
      <th>session_start catalog_tfidf</th>
      <th>session_start main_tfidf</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>122915</th>
      <td>0.049744</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.09694</td>
    </tr>
    <tr>
      <th>463458</th>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.102726</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>999916163</th>
      <td>0.431186</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.172471</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>999941967</th>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.400147</td>
      <td>0.00000</td>
    </tr>
  </tbody>
</table>
<p>3751 rows × 68 columns</p>
</div><p>If the clusters are already fitted, instead of calculate
<a class="reference internal" href="../api/tooling/clusters.html#retentioneering.tooling.clusters.clusters.Clusters.extract_features" title="retentioneering.tooling.clusters.clusters.Clusters.extract_features"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Clusters.extract_features()</span></code></a>
explicitly, you can use <code class="docutils literal notranslate"><span class="pre">clusters.features</span></code> property which
returns <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> representing the calculated features.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clusters</span><span class="o">.</span><span class="n">features</span>
</pre></div>
</div>
</section>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="step_sankey.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">StepSankey</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="funnel.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Funnel</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-data">
   Loading data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-usage">
   General usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#separate-instance-of-clusters">
     Separate instance of Clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eventstream-clusters-property">
     Eventstream.clusters property
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-clusters">
   Fitting clusters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retentioneering-clustering">
     Retentioneering clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#custom-clustering">
     Custom clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cluster-analysis">
   Cluster analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualization">
     Visualization
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#basic-cluster-statistics">
       Basic cluster statistics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#projections">
       Projections
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-individual-clusters">
     Exploring individual clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-comparison">
     Cluster comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-clustering-results">
     Getting clustering results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-features">
     Extracting features
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/user_guides/clusters.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>