# retentioneering tools

## Подготовка к работе

#### Рекомендации по установке на Mac OS на m1/m2.

- Установить PyCharm под нужный процессор, чтобы избежать проблемы с линковкой библиотек.
- Установить pre-commit в виртуальное окружение с Python 3.8.

### Pre-commit

В проекте используется pre-commit хуки.

#### Уставка pre-commit на локальную машину


Pip
```commandline
pip install pre-commit
pre-commit install
```

Conda
```commandline
conda install -c conda-forge pre-commit
pre-commit install
```

#### Установка хуков на pre commit

```commandline
pre-commit install
```

#### Ожидание:

При выполнении команды `git commit ...` будет запускаться хук, который проверит измененные файлы на соответствие правилам. Некоторые из хуков вносят изменения в файл -- например, фиксер импортов.
Если хуки mypy и pyright не выдали ошибок, но были исправления от других хуков, то измененные файлы надо добавить в коммит -- `git add`, после чего снова сделать `git commit`.

Ошибки от хуков mypy и pyright надо исправлять руками, и так же добавлять. Есть тонкости с ошибками от этих хуков для pandas. Если хук ругается на строчку, где применяется какая-то функция от dataframe (iloc или еще что), то сейчас обычно мы выключаем такие ошибки добавлением в конец строки `#type: ignore`

Если пре-коммит хук выдал ошибки, то коммит не был создан.

#### Нюансы

Сейчас проверка хуков исключена для папок `examples` и `tests`.
Есть проблема с jupiter notebooks. Если хук в них внес изменения (обычно это добавление пустой строки в конец файла) -- то сервер все вернет обратно. В таком случае надо погасить сервер. Хотя сейчас такого поведения быть не должно.

#### Ручной запуск

`pre-commit run -a` -- запуск для всех файлов
`pre-commit run --files tests/data_processor/test_dataprocessor_add_column.py` -- запуск для конкретного файла
Больше информации: `pre-commit run -h`

### PyTest

#### Установка

```commandline
pip install pytest
```
---
```commandline
conda install pytest
```

#### Запуск

1. Все тесты
```commandline
pytest
```
Либо для получения большего числа информации
```commandline
pytest -vvv
```
Либо -v, -vv. Нюанс в diff части теста. Если весь diff не влезает на экран в случае ошибки прохождение теста, то он режется. Чтобы увидеть всю картину, стоит использовать `pytest -vvv`. Количество v регулирует количество информации, от 1 до 3.

2. Конкретный тест
```commandline
pytest tests/data_processor/test_dataprocessor_add_column.py
```
Запуск конкретного файла.

---

```commandline
pytest tests/data_processor/test_dataprocessor_add_column.py::TestGraphAddColumn::test_add_column_in_graph_with_helper
```
Запуск конкретного теста в конкретном классе в конкретном файле.
3. Возможен запуск из PyCharm. В файле с тестами слева (где нумерация строк) около тестов есть зеленая стрелка. Через нее можно запустить конкретный тест.
После этого будет создана временная конфигурация для запуска, и нажатием на иконку дебага можно отдебажить тест
4.
